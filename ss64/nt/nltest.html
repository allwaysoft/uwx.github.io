<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="A place for random garbage." />
  

  
  
  
  
  
  
  <title>
    
      Chris Hansen&#39;s Nut Shack
    </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="NLTEST.exe (Windows 2008 or via AD DS)
Network Location Test - List  domain controllers(DCs), Force a remote shutdown, Query the status of trust,
test trust relationships and the state of domain contr">
<meta property="og:type" content="website">
<meta property="og:title" content="Chris Hansen's Nut Shack">
<meta property="og:url" content="http://rafa1231518.github.io/nt/nltest.html">
<meta property="og:site_name" content="Chris Hansen's Nut Shack">
<meta property="og:description" content="NLTEST.exe (Windows 2008 or via AD DS)
Network Location Test - List  domain controllers(DCs), Force a remote shutdown, Query the status of trust,
test trust relationships and the state of domain contr">
<meta property="og:image" content="http://rafa1231518.github.io/../images/top.png">
<meta property="og:updated_time" content="2016-11-02T00:02:52.635Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chris Hansen's Nut Shack">
<meta name="twitter:description" content="NLTEST.exe (Windows 2008 or via AD DS)
Network Location Test - List  domain controllers(DCs), Force a remote shutdown, Query the status of trust,
test trust relationships and the state of domain contr">
<meta name="twitter:image" content="http://rafa1231518.github.io/../images/top.png">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link href="https://fonts.googleapis.com/css?family=Roboto|Source+Code+Pro" rel="stylesheet">
  
    <link rel="stylesheet" href="/css/style.css">
    <style type="text/css">
.header-anchor {
  display: none;
}
    </style>
  
  

  
  <!-- baidu webmaster push -->
  <!-- tracking
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
  -->

</head>
<body class="home blog custom-background custom-font-enabled single-author">
  
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Chris Hansen&#39;s Nut Shack" rel="home">Chris Hansen&#39;s Nut Shack</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">Have a seat, right over there.</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/pagelist">Tools &amp; Stuff</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        
          <div id="primary" class="site-content"><div id="content" role="main"><article id="page-undefined" class="page-undefined post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        <div class="comments-link">
            
            
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- #BeginLibraryItem "/Library/head_nt.lbi" --><!-- #EndLibraryItem --><h1>NLTEST.exe (Windows 2008 or via <abbr title="Active Directory Domain Services or the AD LDS server role">AD DS</abbr>)</h1>
<p>Network Location Test - List  domain controllers(DCs), Force a remote shutdown, Query the status of trust,<br>
test trust relationships and the state of domain controller replication.</p>
<pre>Syntax
      NLTEST [/server:<i>servername</i>] [<i>operation</i>[<i>parameter</i>]
<p>Key<br>
/server: <i>ServerName</i><br>
Run nltest at a remote domain controller: <i>ServerName</i>.<br>
default = the local computer (a domain controller).</p>
<p>/query   Report on the state of the secure channel the last time you used it.<br>
(The secure channel is the one that the NetLogon service established.)</p>
<p>/repl    Force synchronization with the primary domain controller (PDC).<br>
Nltest synchronizes only changes that are not yet replicated to the backup<br>
domain controller (BDC). NT 4.0 BDCs only, not for Active Directory replication.<br>
You must have administrative credentials to use this parameter.</p>
<p><span class="grey">   /sync    Force an immediate synchronization with the PDC of the entire SAM database.<br>
NT 4.0 BDCs only, not for Active Directory replication.<br>
You must have administrative credentials to use this parameter.</span></p>
<p>/pdc_repl Force the PDC to send a synchronization notification to all BDCs.<br>
NT 4.0 PDCs only, not for Active Directory replication.<br>
You must have administrative credentials to use this parameter.</p>
<p>/sc_query: <i>DomainName</i><br>
Report on the state of the secure channel the last time that you used it.<br>
(The secure channel is the one that the NetLogon service established.)<br>
This parameter lists the name of the domain controller that you queried on the<br>
secure channel, also.</p>
<p>/sc_reset:[ <i>DomainName</i>]<br>
Remove, and then rebuild, the secure channel that the NetLogon service established.<br>
You must have administrative credentials to use this parameter.</p>
<p>/sc_verify:[ <i>DomainName</i>]<br>
Check the status of the secure channel that the NetLogon service established.<br>
If the secure channel does not work, this parameter removes the existing channel, and<br>
then builds a new one. You must have administrative credentials to use this parameter.</p>
<p>/sc_change_pwd:[ <i>DomainName</i>]<br>
Change the password for the trust account of a domain that you specify.<br>
If you run nltest on a domain controller, and an explicit trust relationship exists,<br>
then nltest resets the password for the interdomain trust account.<br>
Otherwise, nltest changes the computer account password for the domain that you specify.</p>
<p>/dclist:[ <i>DomainName</i>]<br>
List all DCs in the domain.<br>
This command first queries Active Directory for a list of DCs.<br>
If this query is unsuccessful, nltest then uses the Browser service (if netbios is enabled).</p>
<p>/dcname:[ <i>DomainName</i>]<br>
List the primary domain controller or the PDC emulator for DomainName.</p>
<p>/<b>ds</b>getdc:[ <i>DomainName</i>]<br>
Query the Domain Name System (DNS) server for a list of DCs and their<br>
IP addresses. This parameter also contacts each domain controller to check for connectivity.<br>
The following list shows the values that you can use to filter the list of DCs<br>
or specify alternate names types in the syntax.</p>
<pre><code>        /PDC: Return only the PDC (Windows NT 4.0) or domain controllers designated as the PDC
              emulator (Windows 2000 and later).
        /DS:  Return only those DCs that are Windows 2000 and later.
        /DSP: Return only Windows 2000 and later DCs. If the query finds no such server,
              then return Windows NT 4.0 DCs.
        /GC:  Return only those DCs that are designated as global catalog servers.
        /KDC: Return only those DCs that are designated as Kerberos key distribution centers.
        /TIMESERV: Return only those DCs that are designated as time servers.
        /GTTIMESERV: Return only DCs designated as master time servers.
        /WS: /NetBIOS: Specifies computer names in the syntax as NetBIOS names.
        /DNS: Specify computer names in the syntax as fully qualified domain names (FQDNs).
              If you do not specify a return format, the DC can return either NetBIOS or DNS format.
        /IP:  Return only DCs that have IP addresses. i.e. return only TCP/IP DCs.
        /FORCE: Force the computer to run the command against the DNS server instead of looking in
                the cache for the information.
        /Writable: Require that the returned DC be writable; All Windows 2000 DCs are writable
        /Avoidself: When called from a DC, specifies that the returned DC name should
                    not be the current computer. If the current computer is not a DC, this flag is ignored.
                    This flag can be used to obtain the name of another DC in the domain.
        /LDAPOnly: Specifies that the server returned is an LDAP server. The server returned is not
                   necessarily a DC. This flag can be used with the DS_GC_SERVER_REQUIRED flag
                   to return an LDAP server that also hosts a global catalog server.
                   If this flag is specified, the DS_PDC_REQUIRED, DS_TIMESERV_REQUIRED, 
                   DS_GOOD_TIMESERV_PREFERRED, DS_DIRECTORY_SERVICES_PREFERED,
                   DS_DIRECTORY_SERVICES_REQUIRED, and DS_KDC_REQUIRED flags are ignored.
        /Backg: If the DS_FORCE_REDISCOVERY flag is not specified, this function uses cached DC data.
                If the cached data is more than 15 minutes old, the cache is refreshed by pinging
                the DC. If this flag is specified, this refresh is avoided even if the cached data
                is expired. This flag should be used if the DsGetDcName function is called periodically.
        /DS_6: Require that the returned DC be running Windows Server 2008 or later.
        /DS_8: Require that the returned domain controller be running Windows Server 2012 or later.
        /Try_Next_Closest_Site: When this flag is specified, DsGetDcName attempts to find a DC in
                                the same site as the caller.
        /Ret_DNS: Specifies that the names returned in the DomainControllerName and DomainName members
                  of DomainControllerInfo should be DNS names.
        /Ret_NETBIOS: Specifies that the names returned in the DomainControllerName and DomainName members
                      of DomainControllerInfo should be flat names.
</code></pre>
<p>/<b>dns</b>getdc: <i>DomainName</i><br>
Query the DNS server for a list of domain controllers and their corresponding IP addresses.<br>
values that you can use to filter the list of DCs:<br>
/PDC: Return only those DCs that are PDCs (Windows NT 4.0) or designated as PDC emulators.<br>
/GC:  Return only those DCs that you designate as global catalogs.<br>
/KDC: Return only those DCs that you designate as Kerberos key distribution centers.<br>
/WRITABLE: Return only those DCs that can accept changes to the directory database.<br>
This value returns all Active Directory DCs, but not Windows NT 4.0 BDCs.<br>
/LDAPONLY: Return servers that are running a Lightweight Directory Access Protocol (LDAP) application.<br>
The servers can include LDAP servers that are not DCs.<br>
/FORCE:    Run the command against the DNS server instead of looking in cache.<br>
/SITE <i>Sitename</i>: Sort to list first the records that pertain to <i>Sitename</i>.<br>
/SITESPEC:      Filter the returned records to display only <i>Sitename</i>, used only with /SITE.</p>
<p>/dsgetfti: <i>DomainName</i>[ /UpdateTDO]<br>
Return information about interforest trusts. You use this parameter only for a Windows Server 2008<br>
domain controller that is in the root of the forest. If no interforest trusts exist, this parameter<br>
returns an error. The /UpdateTDO value updates the locally stored information on the interforest trust.</p>
<p>/dsgetsite<br>
Return the name of the site in which the DC resides.</p>
<p>/dsgetsitecov<br>
Return the name of the site that the DC covers. A DC can cover a site<br>
that has no local DC of its own.</p>
<p>/parentdomain<br>
Return the name of the parent domain of the server.</p>
<p>/dsregdns<br>
Refreshe the registration of all DNS records that are specific to a DC that you specify.</p>
<p>/dsderegdns: <i>DnsHostName</i><br>
Deregisters DNS host records for the host that you specify in the DnsHostName parameter.<br>
values you can use to specify which records nltest deregisters:<br>
/DOM:  Specify a DNS domain name for the host to use when you search for records on the DNS server.<br>
If you do not specify this value, nltest uses the DNS domain name as the suffix of the<br>
DnsHostName parameter.<br>
/DSAGUID: Deletes Directory System Agent (DSA) records that are based on a GUID.<br>
DOMGUID: Deletes DNS records that are based on a globally unique identifier (GUID).</p>
<p>/whowill: <i>Domain</i>/ <i>User</i><br>
Find the DC that has the user account that you specify. Use this parameter to determine<br>
whether nltest has replicated the account information to other DCs.</p>
<p>/finduser: <i>User</i><br>
Find the directly-trusted domain that the user account <i>User</i> belongs to.<br>
Use this parameter to troubleshoot logon issues of older client operating systems.</p>
<p><span class="grey">   /transport_notify    Flushe the negative cache to force the discovery of a domain controller.<br>
You can use this parameter for Windows NT 4.0 domain controllers only.<br>
This operation is done automatically when clients log on to Windows 2000 and<br>
Windows Server 2003 domain controllers.</span><br>
/dbflag: <i>HexadecimalFlags</i><br>
Set a new debug flag. For most purposes, use 0x2000FFFF as the value for HexadecimalFlags.<br>
The entry in the Windows Server 2003 registry for debug flags is<br>
HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\DBFlag.</p>
<p>/user: <i>UserName</i><br>
Display many of the attributes that you maintain in the SAM account database for the user that<br>
you specify. You cannot use this parameter for user accounts that are stored in an AD database.</p>
<p>/time: <i>HexadecimalLSL HexadecimalMSL</i><br>
Convert Windows NT Greenwich Mean Time (GMT) time to ASCII. <i>HexadecimalLSL</i> is a hex value for<br>
least significant longword. <i>HexadecimalMSL</i> is a hexa value for most significant longword.</p>
<p>/logon_query<br>
Query the cumulative number of NTLM logon attempts at a console or over a network.</p>
<p>/domain_trusts<br>
Returns a list of trusted domains. /Primary /Forest /Direct_Out /Direct_In /All_Trusts /v.<br>
values that you can use to filter the list of domains:<br>
/Primary: Return only the domain to which the computer account belongs.<br>
/Forest: Return only those domains that are in the same forest as the primary domain.<br>
/Direct_Out: Return only the domains that are explicitly trusted with the primary domain.<br>
/Direct_In: Return only the domains that explicitly trust the primary domain.<br>
/All_Trusts: Return all trusted domains.<br>
/v: Display verbose output, including any domain SIDs and GUIDs that are available.</p>
<p>/dsquerydns<br>
Query for the status of the last update for all DNS records that are specific to a DC.</p>
<p><span class="grey">   /bdc_query: <i>DomainName</i><br>
Query for a list of BDCs in <i>DomainName</i>, and then display their state of synchronization<br>
and replication status. You can use this parameter only for Windows NT 4.0 domain controllers.</span></p>
<p>/sim_sync: <i>DomainName ServerName</i><br>
Simulate full synchronization replication. This is a useful parameter for test environments.</p>
<p><span class="grey">   /list_deltas: <i>FileName<br>
</i>            Display the contents of the FileName change log file, which lists changes to the user account<br>
database. Netlogon.chg is the default name for this log file, which resides only on Windows NT 4.0 BDCs.</span></p>
<p>/cdigest: <i>Message </i>/domain: <i>DomainName</i><br>
Display the current digest that the client uses for the secure channel.<br>
(The digest is the calculation that nltest derives from the password.)<br>
This parameter displays the digest that is based on the previous password, also. Nltest uses<br>
the secure channel for logons between client computers and a domain controller, or for<br>
directory service replication between domain controllers. You can use this parameter in<br>
conjunction with the /sdigest parameter to check the synchronization of trust account passwords.</p>
<p>/sdigest: &lt;Message&gt; /rid: <i>RID_In_Hexadecimal</i><br>
Display the current digest that the server uses for the secure channel.<br>
(The digest is the calculation that nltest derives from the password.)<br>
This parameter displays the digest for the previous password, also. If the digest from the<br>
server matches the digest from the client, then nltest synchronizes the passwords that it<br>
uses for the secure channel. If the digests do not match, then nltest might not have replicated<br>
the password change yet.</p>
<p>/shutdown: <i>Reason</i> [<i>Seconds</i>]<br>
Remotely shut down the server that you specify in <i>ServerName</i>.<br>
Use a string to specify the reason for the shutdown in the Reason value.<br>
Use an integer value of <i>Seconds</i> before the shutdown will occur.<br>
(see InitiateSystemShutdown in the Platform SDK documentation.)</p>
<p>/shutdown_abort<br>
Terminate a system shutdown.</p>
<p>{/help | /?}   Display help at the command prompt.</p></pre><p></p>
<p>Examples</p>
<p>Verify domain controllers in a domain:</p>
<p class="code">nltest /dclist:ss64dom</p>
<p>Show detailed information about a specific user:</p>
<p class="code">nltest /user:"user64"</p>
<p>Verify trust relationship with a specific server:</p>
<p class="code">nltest /server:ss64-DC01 /sc_query:ss64dom</p>
<p class="code">lags: 30 HAS_IP  HAS_TIMESERV <br>
Trusted DC Name \\ss64-DC01.ss64.com <br>
Trusted DC Connection Status Status = 0 0x0 NERR_Success<br>
The command completed successfully</p>
<p class="quote"><i>“..If it disagrees with experiment it is wrong. In that simple statement is the key to science. It does not make any difference how beautiful your guess is. It does not make any difference how smart you are, who made the guess, or what his name is – if it disagrees with experiment it is wrong” ~ <a href="http://www.youtube.com/watch?v=EYPapE-3FRw" target="_blank" rel="external">Richard Feynman</a></i></p>
<p><b> Related commands:</b></p>
<p>RepAdmin - Diagnose Active Directory replication problems between domain controllers.<br>
<a href="http://technet.microsoft.com/en-us/library/cc731968.aspx" target="_blank" rel="external">DcDiag</a> - Analyze the state of domain controllers and report any problems.<br>
DsMgt - Manage password operations over unsecured connections, AD Lightweight Directory Services application partitions, flexible single master operations (FSMO), and clean up AD metadata.<br>
<a href="setspn.html">SetSpn</a> - Read, modify, or delete the Service Principal Names (SPN) for an Active Directory service account. <br>
</p><!-- #BeginLibraryItem "/Library/foot_nt.lbi" --><p>
<!-- windows300 -->
<ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-6140977852749469" data-ad-slot="7649547908"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<hr>
<div id="bl" class="footer"><a href="nltest.html#"><img src="../images/top.png" width="30" height="22" alt="Back to the Top"></a></div>
<div id="br" class="footer, tagline">© Copyright <a href="http://ss64.com/" target="_blank" rel="external">SS64.com</a> 1999-2016<br>
Some rights reserved</div><!-- #EndLibraryItem -->

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    Posted at <a href="/nt/nltest.html">
    <time datetime="2016-09-04T22:26:55.000Z" class="entry-date">
        2016-09-04
    </time>
</a> (click date for permalink).
    
    
    </footer>
</article>


    






</div></div>
          <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="Search" />
    </div>
</form></aside>
  
    
  
    
  
    
  
    
  
    
  
</div>
        
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2016 chrishansen69 (rafa1231518).
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="https://github.com/wizardforcel/hexo-theme-cyanstyle">Wizard Zhang (wizardforcel)</a></p>
</footer>
    <!-- tracking
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
-->

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
  
</body>
</html>