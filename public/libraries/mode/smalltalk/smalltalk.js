(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("smalltalk",function(e){var t=/[+\-\/\\*~<>=@%|&?!.,:;^]/;var n=/true|false|nil|self|super|thisContext/;var i=function(e,t){this.next=e;this.parent=t};var a=function(e,t,n){this.name=e;this.context=t;this.eos=n};var r=function(){this.context=new i(s,null);this.expectVariable=true;this.indentation=0;this.userIndentationDelta=0};r.prototype.userIndent=function(t){this.userIndentationDelta=t>0?t/e.indentUnit-this.indentation:0};var s=function(e,r,s){var c=new a(null,r,false);var d=e.next();if(d==='"'){c=o(e,new i(o,r))}else if(d==="'"){c=l(e,new i(l,r))}else if(d==="#"){if(e.peek()==="'"){e.next();c=f(e,new i(f,r))}else{if(e.eatWhile(/[^\s.{}\[\]()]/))c.name="string-2";else c.name="meta"}}else if(d==="$"){if(e.next()==="<"){e.eatWhile(/[^\s>]/);e.next()}c.name="string-2"}else if(d==="|"&&s.expectVariable){c.context=new i(u,r)}else if(/[\[\]{}()]/.test(d)){c.name="bracket";c.eos=/[\[{(]/.test(d);if(d==="["){s.indentation++}else if(d==="]"){s.indentation=Math.max(0,s.indentation-1)}}else if(t.test(d)){e.eatWhile(t);c.name="operator";c.eos=d!==";"}else if(/\d/.test(d)){e.eatWhile(/[\w\d]/);c.name="number"}else if(/[\w_]/.test(d)){e.eatWhile(/[\w\d_]/);c.name=s.expectVariable?n.test(e.current())?"keyword":"variable":null}else{c.eos=s.expectVariable}return c};var o=function(e,t){e.eatWhile(/[^"]/);return new a("comment",e.eat('"')?t.parent:t,true)};var l=function(e,t){e.eatWhile(/[^']/);return new a("string",e.eat("'")?t.parent:t,false)};var f=function(e,t){e.eatWhile(/[^']/);return new a("string-2",e.eat("'")?t.parent:t,false)};var u=function(e,t){var n=new a(null,t,false);var i=e.next();if(i==="|"){n.context=t.parent;n.eos=true}else{e.eatWhile(/[^|]/);n.name="variable"}return n};return{startState:function(){return new r},token:function(e,t){t.userIndent(e.indentation());if(e.eatSpace()){return null}var n=t.context.next(e,t.context,t);t.context=n.context;t.expectVariable=n.eos;return n.name},blankLine:function(e){e.userIndent(0)},indent:function(t,n){var i=t.context.next===s&&n&&n.charAt(0)==="]"?-1:t.userIndentationDelta;return(t.indentation+i)*e.indentUnit},electricChars:"]"}});e.defineMIME("text/x-stsrc",{name:"smalltalk"})});