(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("rst",function(t,a){var r=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var c=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var n=/^``[^`\s](?:[^`]*[^`\s])``/;var s=/^(?:[\d]+(?:[\.,]\d+)*)/;var m=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var o=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var l="[Hh][Tt][Tt][Pp][Ss]?://";var i="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var f="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var h=new RegExp("^"+l+i+f);var u={token:function(e){if(e.match(r)&&e.match(/\W+|$/,false))return"strong";if(e.match(c)&&e.match(/\W+|$/,false))return"em";if(e.match(n)&&e.match(/\W+|$/,false))return"string-2";if(e.match(s))return"number";if(e.match(m))return"positive";if(e.match(o))return"negative";if(e.match(h))return"link";while(e.next()!=null){if(e.match(r,false))break;if(e.match(c,false))break;if(e.match(n,false))break;if(e.match(s,false))break;if(e.match(m,false))break;if(e.match(o,false))break;if(e.match(h,false))break}return null}};var p=e.getMode(t,a.backdrop||"rst-base");return e.overlayMode(p,u,true)},"python","stex");e.defineMode("rst-base",function(t){function a(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,a){return typeof t[a]!="undefined"?t[a]:e})}var r=e.getMode(t,"python");var c=e.getMode(t,"stex");var n="\\s+";var s="(?:\\s*|\\W|$)",m=new RegExp(a("^{0}",s));var o="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",l=new RegExp(a("^{0}",o));var i="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var f=a("(?:{0}|`{1}`)",o,i);var h="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var u="(?:[^\\`]+)",p=new RegExp(a("^{0}",u));var d=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var k=new RegExp(a("^\\.\\.{0}",n));var x=new RegExp(a("^_{0}:{1}|^__:{1}",f,s));var v=new RegExp(a("^{0}::{1}",f,s));var b=new RegExp(a("^\\|{0}\\|{1}{2}::{3}",h,n,f,s));var w=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]{1}",f,s));var g=new RegExp(a("^\\[{0}\\]{1}",f,s));var E=new RegExp(a("^\\|{0}\\|",h));var R=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]_",f));var y=new RegExp(a("^\\[{0}\\]_",f));var _=new RegExp(a("^{0}__?",f));var $=new RegExp(a("^`{0}`_",u));var S=new RegExp(a("^:{0}:`{1}`{2}",o,u,s));var M=new RegExp(a("^`{1}`:{0}:{2}",o,u,s));var W=new RegExp(a("^:{0}:{1}",o,s));var q=new RegExp(a("^{0}",f));var T=new RegExp(a("^::{0}",s));var j=new RegExp(a("^\\|{0}\\|",h));var I=new RegExp(a("^{0}",n));var A=new RegExp(a("^{0}",f));var C=new RegExp(a("^::{0}",s));var H=new RegExp("^_");var P=new RegExp(a("^{0}|_",f));var z=new RegExp(a("^:{0}",s));var B=new RegExp("^::\\s*$");var D=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function F(t,a){var n=null;if(t.sol()&&t.match(D,false)){Q(a,N,{mode:r,local:e.startState(r)})}else if(t.sol()&&t.match(k)){Q(a,G);n="meta"}else if(t.sol()&&t.match(d)){Q(a,F);n="header"}else if(V(a)==S||t.match(S,false)){switch(U(a)){case 0:Q(a,F,O(S,1));t.match(/^:/);n="meta";break;case 1:Q(a,F,O(S,2));t.match(l);n="keyword";if(t.current().match(/^(?:math|latex)/)){a.tmp_stex=true}break;case 2:Q(a,F,O(S,3));t.match(/^:`/);n="meta";break;case 3:if(a.tmp_stex){a.tmp_stex=undefined;a.tmp={mode:c,local:e.startState(c)}}if(a.tmp){if(t.peek()=="`"){Q(a,F,O(S,4));a.tmp=undefined;break}n=a.tmp.mode.token(t,a.tmp.local);break}Q(a,F,O(S,4));t.match(p);n="string";break;case 4:Q(a,F,O(S,5));t.match(/^`/);n="meta";break;case 5:Q(a,F,O(S,6));t.match(m);break;default:Q(a,F)}}else if(V(a)==M||t.match(M,false)){switch(U(a)){case 0:Q(a,F,O(M,1));t.match(/^`/);n="meta";break;case 1:Q(a,F,O(M,2));t.match(p);n="string";break;case 2:Q(a,F,O(M,3));t.match(/^`:/);n="meta";break;case 3:Q(a,F,O(M,4));t.match(l);n="keyword";break;case 4:Q(a,F,O(M,5));t.match(/^:/);n="meta";break;case 5:Q(a,F,O(M,6));t.match(m);break;default:Q(a,F)}}else if(V(a)==W||t.match(W,false)){switch(U(a)){case 0:Q(a,F,O(W,1));t.match(/^:/);n="meta";break;case 1:Q(a,F,O(W,2));t.match(l);n="keyword";break;case 2:Q(a,F,O(W,3));t.match(/^:/);n="meta";break;case 3:Q(a,F,O(W,4));t.match(m);break;default:Q(a,F)}}else if(V(a)==E||t.match(E,false)){switch(U(a)){case 0:Q(a,F,O(E,1));t.match(j);n="variable-2";break;case 1:Q(a,F,O(E,2));if(t.match(/^_?_?/))n="link";break;default:Q(a,F)}}else if(t.match(R)){Q(a,F);n="quote"}else if(t.match(y)){Q(a,F);n="quote"}else if(t.match(_)){Q(a,F);if(!t.peek()||t.peek().match(/^\W$/)){n="link"}}else if(V(a)==$||t.match($,false)){switch(U(a)){case 0:if(!t.peek()||t.peek().match(/^\W$/)){Q(a,F,O($,1))}else{t.match($)}break;case 1:Q(a,F,O($,2));t.match(/^`/);n="link";break;case 2:Q(a,F,O($,3));t.match(p);break;case 3:Q(a,F,O($,4));t.match(/^`_/);n="link";break;default:Q(a,F)}}else if(t.match(B)){Q(a,K)}else{if(t.next())Q(a,F)}return n}function G(t,a){var n=null;if(V(a)==b||t.match(b,false)){switch(U(a)){case 0:Q(a,G,O(b,1));t.match(j);n="variable-2";break;case 1:Q(a,G,O(b,2));t.match(I);break;case 2:Q(a,G,O(b,3));t.match(A);n="keyword";break;case 3:Q(a,G,O(b,4));t.match(C);n="meta";break;default:Q(a,F)}}else if(V(a)==v||t.match(v,false)){switch(U(a)){case 0:Q(a,G,O(v,1));t.match(q);n="keyword";if(t.current().match(/^(?:math|latex)/))a.tmp_stex=true;else if(t.current().match(/^python/))a.tmp_py=true;break;case 1:Q(a,G,O(v,2));t.match(T);n="meta";if(t.match(/^latex\s*$/)||a.tmp_stex){a.tmp_stex=undefined;Q(a,N,{mode:c,local:e.startState(c)})}break;case 2:Q(a,G,O(v,3));if(t.match(/^python\s*$/)||a.tmp_py){a.tmp_py=undefined;Q(a,N,{mode:r,local:e.startState(r)})}break;default:Q(a,F)}}else if(V(a)==x||t.match(x,false)){switch(U(a)){case 0:Q(a,G,O(x,1));t.match(H);t.match(P);n="link";break;case 1:Q(a,G,O(x,2));t.match(z);n="meta";break;default:Q(a,F)}}else if(t.match(w)){Q(a,F);n="quote"}else if(t.match(g)){Q(a,F);n="quote"}else{t.eatSpace();if(t.eol()){Q(a,F)}else{t.skipToEnd();Q(a,J);n="comment"}}return n}function J(e,t){return L(e,t,"comment")}function K(e,t){return L(e,t,"meta")}function L(e,t,a){if(e.eol()||e.eatSpace()){e.skipToEnd();return a}else{Q(t,F);return null}}function N(e,t){if(t.ctx.mode&&t.ctx.local){if(e.sol()){if(!e.eatSpace())Q(t,F);return null}return t.ctx.mode.token(e,t.ctx.local)}Q(t,F);return null}function O(e,t,a,r){return{phase:e,stage:t,mode:a,local:r}}function Q(e,t,a){e.tok=t;e.ctx=a||{}}function U(e){return e.ctx.stage||0}function V(e){return e.ctx.phase}return{startState:function(){return{tok:F,ctx:O(undefined,0)}},copyState:function(t){var a=t.ctx,r=t.tmp;if(a.local)a={mode:a.mode,local:e.copyState(a.mode,a.local)};if(r)r={mode:r.mode,local:e.copyState(r.mode,r.local)};return{tok:t.tok,ctx:a,tmp:r}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex");e.defineMIME("text/x-rst","rst")});