(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("django:inner",function(){var e=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],t=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],r=["==","!=","<",">","<=",">="],i=["in","not","or","and"];e=new RegExp("^\\b("+e.join("|")+")\\b");t=new RegExp("^\\b("+t.join("|")+")\\b");r=new RegExp("^\\b("+r.join("|")+")\\b");i=new RegExp("^\\b("+i.join("|")+")\\b");function n(e,t){if(e.match("{{")){t.tokenize=o;return"tag"}else if(e.match("{%")){t.tokenize=l;return"tag"}else if(e.match("{#")){t.tokenize=u;return"comment"}while(e.next()!=null&&!e.match(/\{[{%#]/,false)){}return null}function a(e,t){return function(r,i){if(!i.escapeNext&&r.eat(e)){i.tokenize=t}else{if(i.escapeNext){i.escapeNext=false}var n=r.next();if(n=="\\"){i.escapeNext=true}}return"string"}}function o(e,r){if(r.waitDot){r.waitDot=false;if(e.peek()!="."){return"null"}if(e.match(/\.\W+/)){return"error"}else if(e.eat(".")){r.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}if(r.waitPipe){r.waitPipe=false;if(e.peek()!="|"){return"null"}if(e.match(/\.\W+/)){return"error"}else if(e.eat("|")){r.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}if(r.waitProperty){r.waitProperty=false;if(e.match(/\b(\w+)\b/)){r.waitDot=true;r.waitPipe=true;return"property"}}if(r.waitFilter){r.waitFilter=false;if(e.match(t)){return"variable-2"}}if(e.eatSpace()){r.waitProperty=false;return"null"}if(e.match(/\b\d+(\.\d+)?\b/)){return"number"}if(e.match("'")){r.tokenize=a("'",r.tokenize);return"string"}else if(e.match('"')){r.tokenize=a('"',r.tokenize);return"string"}if(e.match(/\b(\w+)\b/)&&!r.foundVariable){r.waitDot=true;r.waitPipe=true;return"variable"}if(e.match("}}")){r.waitProperty=null;r.waitFilter=null;r.waitDot=null;r.waitPipe=null;r.tokenize=n;return"tag"}e.next();return"null"}function l(o,l){if(l.waitDot){l.waitDot=false;if(o.peek()!="."){return"null"}if(o.match(/\.\W+/)){return"error"}else if(o.eat(".")){l.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}if(l.waitPipe){l.waitPipe=false;if(o.peek()!="|"){return"null"}if(o.match(/\.\W+/)){return"error"}else if(o.eat("|")){l.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}if(l.waitProperty){l.waitProperty=false;if(o.match(/\b(\w+)\b/)){l.waitDot=true;l.waitPipe=true;return"property"}}if(l.waitFilter){l.waitFilter=false;if(o.match(t)){return"variable-2"}}if(o.eatSpace()){l.waitProperty=false;return"null"}if(o.match(/\b\d+(\.\d+)?\b/)){return"number"}if(o.match("'")){l.tokenize=a("'",l.tokenize);return"string"}else if(o.match('"')){l.tokenize=a('"',l.tokenize);return"string"}if(o.match(r)){return"operator"}if(o.match(i)){return"keyword"}var u=o.match(e);if(u){if(u[0]=="comment"){l.blockCommentTag=true}return"keyword"}if(o.match(/\b(\w+)\b/)){l.waitDot=true;l.waitPipe=true;return"variable"}if(o.match("%}")){l.waitProperty=null;l.waitFilter=null;l.waitDot=null;l.waitPipe=null;if(l.blockCommentTag){l.blockCommentTag=false;l.tokenize=f}else{l.tokenize=n}return"tag"}o.next();return"null"}function u(e,t){if(e.match(/^.*?#\}/))t.tokenize=n;else e.skipToEnd();return"comment"}function f(e,t){if(e.match(/\{%\s*endcomment\s*%\}/,false)){t.tokenize=l;e.match("{%");return"tag"}else{e.next();return"comment"}}return{startState:function(){return{tokenize:n}},token:function(e,t){return t.tokenize(e,t)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});e.defineMode("django",function(t){var r=e.getMode(t,"text/html");var i=e.getMode(t,"django:inner");return e.overlayMode(r,i)});e.defineMIME("text/x-django","django")});