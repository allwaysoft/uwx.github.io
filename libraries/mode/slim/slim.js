(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("slim",function(t){var n=e.getMode(t,{name:"htmlmixed"});var i=e.getMode(t,"ruby");var r={html:n,ruby:i};var u={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"};var o=function(e){var t=[];for(var n in e)t.push(n);return new RegExp("^("+t.join("|")+"):")}(u);var a={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null};var l={"{":"}","[":"]","(":")"};var c="_a-zA-ZÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�";var s=c+"\\-0-9·̀-ͯ‿-⁀";var f=new RegExp("^[:"+c+"](?::["+s+"]|["+s+"]*)");var k=new RegExp("^[:"+c+"][:\\."+s+"]*(?=\\s*=)");var d=new RegExp("^[:"+c+"][:\\."+s+"]*");var m=/^\.-?[_a-zA-Z]+[\w\-]*/;var b=/^#[_a-zA-Z]+[\w\-]*/;function z(e,t,n){var i=function(i,r){r.tokenize=t;if(i.pos<e){i.pos=e;return n}return r.tokenize(i,r)};return function(e,n){n.tokenize=i;return t(e,n)}}function p(e,t,n,i,r){var u=e.current();var o=u.search(n);if(o>-1){t.tokenize=z(e.pos,t.tokenize,r);e.backUp(u.length-o-i)}return r}function h(e,t){e.stack={parent:e.stack,style:"continuation",indented:t,tokenize:e.line};e.line=e.tokenize}function x(e){if(e.line==e.tokenize){e.line=e.stack.tokenize;e.stack=e.stack.parent}}function v(e,t){return function(n,i){x(i);if(n.match(/^\\$/)){h(i,e);return"lineContinuation"}var r=t(n,i);if(n.eol()&&n.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)){n.backUp(1)}return r}}function y(e,t){return function(n,i){x(i);var r=t(n,i);if(n.eol()&&n.current().match(/,$/)){h(i,e)}return r}}function S(e,t){return function(n,i){var r=n.peek();if(r==e&&i.rubyState.tokenize.length==1){n.next();i.tokenize=t;return"closeAttributeTag"}else{return g(n,i)}}}function w(t){var n;var r=function(e,i){if(i.rubyState.tokenize.length==1&&!i.rubyState.context.prev){e.backUp(1);if(e.eatSpace()){i.rubyState=n;i.tokenize=t;return t(e,i)}e.next()}return g(e,i)};return function(t,u){n=u.rubyState;u.rubyState=e.startState(i);u.tokenize=r;return g(t,u)}}function g(e,t){return i.token(e,t.rubyState)}function M(e,t){if(e.match(/^\\$/)){return"lineContinuation"}return C(e,t)}function C(e,t){if(e.match(/^#\{/)){t.tokenize=S("}",t.tokenize);return null}return p(e,t,/[^\\]#\{/,1,n.token(e,t.htmlState))}function E(e){return function(t,n){var i=M(t,n);if(t.eol())n.tokenize=e;return i}}function A(e,t,n){t.stack={parent:t.stack,style:"html",indented:e.column()+n,tokenize:t.line};t.line=t.tokenize=C;return null}function L(e,t){e.skipToEnd();return t.stack.style}function $(e,t){t.stack={parent:t.stack,style:"comment",indented:t.indented+1,tokenize:t.line};t.line=L;return L(e,t)}function T(e,t){if(e.eat(t.stack.endQuote)){t.line=t.stack.line;t.tokenize=t.stack.tokenize;t.stack=t.stack.parent;return null}if(e.match(d)){t.tokenize=U;return"slimAttribute"}e.next();return null}function U(e,t){if(e.match(/^==?/)){t.tokenize=j;return null}return T(e,t)}function j(e,t){var n=e.peek();if(n=='"'||n=="'"){t.tokenize=N(n,"string",true,false,T);e.next();return t.tokenize(e,t)}if(n=="["){return w(T)(e,t)}if(e.match(/^(true|false|nil)\b/)){t.tokenize=T;return"keyword"}return w(T)(e,t)}function O(e,t,n){e.stack={parent:e.stack,style:"wrapper",indented:e.indented+1,tokenize:n,line:e.line,endQuote:t};e.line=e.tokenize=T;return null}function R(t,n){if(t.match(/^#\{/)){n.tokenize=S("}",n.tokenize);return null}var i=new e.StringStream(t.string.slice(n.stack.indented),t.tabSize);i.pos=t.pos-n.stack.indented;i.start=t.start-n.stack.indented;i.lastColumnPos=t.lastColumnPos-n.stack.indented;i.lastColumnValue=t.lastColumnValue-n.stack.indented;var r=n.subMode.token(i,n.subState);t.pos=i.pos+n.stack.indented;return r}function q(e,t){t.stack.indented=e.column();t.line=t.tokenize=R;return t.tokenize(e,t)}function I(n){var i=u[n];var r=e.mimeModes[i];if(r){return e.getMode(t,r)}var o=e.modes[i];if(o){return o(t,{name:i})}return e.getMode(t,"null")}function P(e){if(!r.hasOwnProperty(e)){return r[e]=I(e)}return r[e]}function Z(t,n){var i=P(t);var r=e.startState(i);n.subMode=i;n.subState=r;n.stack={parent:n.stack,style:"sub",indented:n.indented+1,tokenize:n.line};n.line=n.tokenize=q;return"slimSubmode"}function _(e,t){e.skipToEnd();return"slimDoctype"}function D(e,t){var n=e.peek();if(n=="<"){return(t.tokenize=E(t.tokenize))(e,t)}if(e.match(/^[|']/)){return A(e,t,1)}if(e.match(/^\/(!|\[\w+])?/)){return $(e,t)}if(e.match(/^(-|==?[<>]?)/)){t.tokenize=v(e.column(),y(e.column(),g));return"slimSwitch"}if(e.match(/^doctype\b/)){t.tokenize=_;return"keyword"}var i=e.match(o);if(i){return Z(i[1],t)}return V(e,t)}function Q(e,t){if(t.startOfLine){return D(e,t)}return V(e,t)}function V(e,t){if(e.eat("*")){t.tokenize=w(B);return null}if(e.match(f)){t.tokenize=B;return"slimTag"}return F(e,t)}function B(e,t){if(e.match(/^(<>?|><?)/)){t.tokenize=F;return null}return F(e,t)}function F(e,t){if(e.match(b)){t.tokenize=F;return"slimId"}if(e.match(m)){t.tokenize=F;return"slimClass"}return G(e,t)}function G(e,t){if(e.match(/^([\[\{\(])/)){return O(t,l[RegExp.$1],G)}if(e.match(k)){t.tokenize=H;return"slimAttribute"}if(e.peek()=="*"){e.next();t.tokenize=w(W);return null}return W(e,t)}function H(e,t){if(e.match(/^==?/)){t.tokenize=J;return null}return G(e,t)}function J(e,t){var n=e.peek();if(n=='"'||n=="'"){t.tokenize=N(n,"string",true,false,G);e.next();return t.tokenize(e,t)}if(n=="["){return w(G)(e,t)}if(n==":"){return w(K)(e,t)}if(e.match(/^(true|false|nil)\b/)){t.tokenize=G;return"keyword"}return w(G)(e,t)}function K(e,t){e.backUp(1);if(e.match(/^[^\s],(?=:)/)){t.tokenize=w(K);return null}e.next();return G(e,t)}function N(e,t,n,i,r){return function(u,o){x(o);var a=u.current().length==0;if(u.match(/^\\$/,a)){if(!a)return t;h(o,o.indented);return"lineContinuation"}if(u.match(/^#\{/,a)){if(!a)return t;o.tokenize=S("}",o.tokenize);return null}var l=false,c;while((c=u.next())!=null){if(c==e&&(i||!l)){o.tokenize=r;break}if(n&&c=="#"&&!l){if(u.eat("{")){u.backUp(2);break}}l=!l&&c=="\\"}if(u.eol()&&l){u.backUp(1)}return t}}function W(e,t){if(e.match(/^==?/)){t.tokenize=g;return"slimSwitch"}if(e.match(/^\/$/)){t.tokenize=Q;return null}if(e.match(/^:/)){t.tokenize=V;return"slimSwitch"}A(e,t,0);return t.tokenize(e,t)}var X={startState:function(){var t=e.startState(n);var r=e.startState(i);return{htmlState:t,rubyState:r,stack:null,last:null,tokenize:Q,line:Q,indented:0}},copyState:function(t){return{htmlState:e.copyState(n,t.htmlState),rubyState:e.copyState(i,t.rubyState),subMode:t.subMode,subState:t.subMode&&e.copyState(t.subMode,t.subState),stack:t.stack,last:t.last,tokenize:t.tokenize,line:t.line}},token:function(e,t){if(e.sol()){t.indented=e.indentation();t.startOfLine=true;t.tokenize=t.line;while(t.stack&&t.stack.indented>t.indented&&t.last!="slimSubmode"){t.line=t.tokenize=t.stack.tokenize;t.stack=t.stack.parent;t.subMode=null;t.subState=null}}if(e.eatSpace())return null;var n=t.tokenize(e,t);t.startOfLine=false;if(n)t.last=n;return a.hasOwnProperty(n)?a[n]:n},blankLine:function(e){if(e.subMode&&e.subMode.blankLine){return e.subMode.blankLine(e.subState)}},innerMode:function(e){if(e.subMode)return{state:e.subState,mode:e.subMode};return{state:e,mode:X}}};return X},"htmlmixed","ruby");e.defineMIME("text/x-slim","slim");e.defineMIME("application/x-slim","slim")});