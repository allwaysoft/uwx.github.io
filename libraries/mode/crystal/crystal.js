(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("crystal",function(e){function t(e,t){return new RegExp((t?"":"^")+"(?:"+e.join("|")+")"+(t?"$":"\\b"))}function r(e,t,r){r.tokenize.push(e);return e(t,r)}var n=/^(?:[-+\/%|&^]|\*\*?|[<>]{2})/;var a=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var i=/^(?:\[\][?=]?)/;var u=/^(?:\.(?:\.{2})?|->|[?:])/;var f=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var o=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var c=t(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","ifdef","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","sizeof","struct","super","then","type","typeof","union","unless","until","when","while","with","yield","__DIR__","__FILE__","__LINE__"]);var s=t(["true","false","nil","self"]);var l=["def","fun","macro","class","module","struct","lib","enum","union","if","unless","case","while","until","begin","then","do","for","ifdef"];var m=t(l);var h=["end","else","elsif","rescue","ensure"];var d=t(h);var p=["\\)","\\}","\\]"];var k=new RegExp("^(?:"+p.join("|")+")$");var v={def:y,fun:y,macro:x,"class":I,module:I,struct:I,lib:I,"enum":I,union:I};var F={"[":"]","{":"}","(":")","<":">"};function b(e,t){if(e.eatSpace()){return null}if(t.lastToken!="\\"&&e.match("{%",false)){return r(_("%","%"),e,t)}if(t.lastToken!="\\"&&e.match("{{",false)){return r(_("{","}"),e,t)}if(e.peek()=="#"){e.skipToEnd();return"comment"}var l;if(e.match(f)){e.eat(/[?!]/);l=e.current();if(e.eat(":")){return"atom"}else if(t.lastToken=="."){return"property"}else if(c.test(l)){if(t.lastToken!="abstract"&&m.test(l)){if(!(l=="fun"&&t.blocks.indexOf("lib")>=0)){t.blocks.push(l);t.currentIndent+=1}}else if(d.test(l)){t.blocks.pop();t.currentIndent-=1}if(v.hasOwnProperty(l)){t.tokenize.push(v[l])}return"keyword"}else if(s.test(l)){return"atom"}return"variable"}if(e.eat("@")){if(e.peek()=="["){return r(z("[","]","meta"),e,t)}e.eat("@");e.match(f)||e.match(o);return"variable-2"}if(e.eat("$")){e.eat(/[0-9]+|\?/)||e.match(f)||e.match(o);return"variable-3"}if(e.match(o)){return"tag"}if(e.eat(":")){if(e.eat('"')){return r(w('"',"atom",false),e,t)}else if(e.match(f)||e.match(o)||e.match(n)||e.match(a)||e.match(i)){return"atom"}e.eat(":");return"operator"}if(e.eat('"')){return r(w('"',"string",true),e,t)}if(e.peek()=="%"){var h="string";var p=true;var k;if(e.match("%r")){h="string-2";k=e.next()}else if(e.match("%w")){p=false;k=e.next()}else{if(k=e.match(/^%([^\w\s=])/)){k=k[1]}else if(e.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}if(F.hasOwnProperty(k)){k=F[k]}return r(w(k,h,p),e,t)}if(e.eat("'")){e.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);e.eat("'");return"atom"}if(e.eat("0")){if(e.eat("x")){e.match(/^[0-9a-fA-F]+/)}else if(e.eat("o")){e.match(/^[0-7]+/)}else if(e.eat("b")){e.match(/^[01]+/)}return"number"}if(e.eat(/\d/)){e.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(e.match(n)){e.eat("=");return"operator"}if(e.match(a)||e.match(u)){return"operator"}if(l=e.match(/[({[]/,false)){l=l[0];return r(z(l,F[l],null),e,t)}if(e.eat("\\")){e.next();return"meta"}e.next();return null}function z(e,t,r,n){return function(a,i){if(!n&&a.match(e)){i.tokenize[i.tokenize.length-1]=z(e,t,r,true);i.currentIndent+=1;return r}var u=b(a,i);if(a.current()===t){i.tokenize.pop();i.currentIndent-=1;u=r}return u}}function _(e,t,r){return function(n,a){if(!r&&n.match("{"+e)){a.currentIndent+=1;a.tokenize[a.tokenize.length-1]=_(e,t,true);return"meta"}if(n.match(t+"}")){a.currentIndent-=1;a.tokenize.pop();return"meta"}return b(n,a)}}function x(e,t){if(e.eatSpace()){return null}var r;if(r=e.match(f)){if(r=="def"){return"keyword"}e.eat(/[?!]/)}t.tokenize.pop();return"def"}function y(e,t){if(e.eatSpace()){return null}if(e.match(f)){e.eat(/[!?]/)}else{e.match(n)||e.match(a)||e.match(i)}t.tokenize.pop();return"def"}function I(e,t){if(e.eatSpace()){return null}e.match(o);t.tokenize.pop();return"def"}function w(e,t,r){return function(n,a){var i=false;while(n.peek()){if(!i){if(n.match("{%",false)){a.tokenize.push(_("%","%"));return t}if(n.match("{{",false)){a.tokenize.push(_("{","}"));return t}if(r&&n.match("#{",false)){a.tokenize.push(z("#{","}","meta"));return t}var u=n.next();if(u==e){a.tokenize.pop();return t}i=u=="\\"}else{n.next();i=false}}return t}}return{startState:function(){return{tokenize:[b],currentIndent:0,lastToken:null,blocks:[]}},token:function(e,t){var r=t.tokenize[t.tokenize.length-1](e,t);var n=e.current();if(r&&r!="comment"){t.lastToken=n}return r},indent:function(t,r){r=r.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(d.test(r)||k.test(r)){return e.indentUnit*(t.currentIndent-1)}return e.indentUnit*t.currentIndent},fold:"indent",electricInput:t(p.concat(h),true),lineComment:"#"}});e.defineMIME("text/x-crystal","crystal")});